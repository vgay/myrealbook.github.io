<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>Marques de repères et de reprises (Rehearsal Marks) - MyRealBook </title>
        
        <meta name="robots" content="noindex,nofollow" />
        <meta name="generator" content="Publii Open-Source CMS for Static Site" />

        
        
        <link rel="alternate" type="application/atom+xml" href="https://myrealbook.vintherine.org/feed.xml" />
<link rel="alternate" type="application/json" href="https://myrealbook.vintherine.org/feed.json" />

        <meta property="og:title" content="Marques de repères et de reprises (Rehearsal Marks)" /><meta property="og:site_name" content="MyRealBook" /><meta property="og:description" content="C'est ce qu'on appelle un marronnier (sujet qui revient régulièrement) : comment gérer les marques de repères et de reprises (reheasal marks), leurs positions verticales et horizontales, comment les faire apparaître en fin de ligne, comment mettre deux marques successivement... Le besoin le plus fréquemment exprimé est une ligne se terminant par un 'D.C. al Coda', la suivante commençant par la Coda en question. Voici un petit tour de mes modestes connaissances  :la commande \mark et ses (nombreux) \overrideDouble-Mark : deux marques à un saut de lignePolyMark, un graveur alternatif" /><meta property="og:url" content="https://myrealbook.vintherine.org/double-marks.html" /><meta property="og:type" content="article" />
        <style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style>
        <link rel="stylesheet" href="https://myrealbook.vintherine.org/assets/css/style.css?v=489237eb5e2f09dd77c9332d52b3a5e5">       
        <script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://myrealbook.vintherine.org/double-marks.html"},"headline":"Marques de repères et de reprises (Rehearsal Marks)","datePublished":"2022-07-08T07:23","dateModified":"2022-07-08T08:04","description":"C'est ce qu'on appelle un marronnier (sujet qui revient régulièrement) : comment gérer les marques de repères et de reprises (reheasal marks), leurs positions verticales et horizontales, comment les faire apparaître en fin de ligne, comment mettre deux marques successivement... Le besoin le plus fréquemment exprimé est une ligne se terminant par un 'D.C. al Coda', la suivante commençant par la Coda en question. Voici un petit tour de mes modestes connaissances  :la commande \\mark et ses (nombreux) \\overrideDouble-Mark : deux marques à un saut de lignePolyMark, un graveur alternatif","author":{"@type":"Person","name":"Vincent","url":"https://myrealbook.vintherine.org/authors/vincent/"},"publisher":{"@type":"Organization","name":"Vincent"}}</script>        
        
        <link type="application/atom+xml" rel="alternate" href="https://myrealbook.vintherine.org/feed.xml"/>
<link type="application/json" rel="alternate" href="https://myrealbook.vintherine.org/feed.json"/>
    </head>
    <body>
        <header class="header" id="js-header">

   <a href="https://myrealbook.vintherine.org/" class="logo">
         MyRealBook
   </a>

      <nav class="navbar js-navbar">
         <button class="navbar__toggle js-toggle" aria-label="Menu">
            <span class="navbar__toggle-box">
               <span class="navbar__toggle-inner">Menu</span>
            </span>
         </button>
         <ul class="navbar__menu">
                  <li>
                  <a
                     href="https://myrealbook.vintherine.org/index.html"
                        target="_self"
         >
                     Blog
                  </a>
         
            </li>
                  <li>
                  <a
                     href="https://myrealbook.vintherine.org/myrealbook-les-partitions.html"
                        target="_self"
         >
                     Partitions
                  </a>
         
            </li>
                  <li>
                  <a
                     href="https://myrealbook.vintherine.org/about.html"
                        target="_self"
         >
                     À propos
                  </a>
         
            </li>
                  <li>
                  <a
                     href="https://myrealbook.vintherine.org/feed.xml"
                        target="_self"
         >
                     Flux RSS
                  </a>
         
            </li>
         </ul>      </nav>

      <div class="search">
          <div class="search__overlay js-search-overlay">
            <form action="https://myrealbook.vintherine.org/search.html" class="search__form">
               <input
                  class="search__input js-search-input"
                  type="search"
                  name="q"
                  aria-label="Search input" 
                  placeholder="search..."
                  autofocus="autofocus"/>
               <button class="search__submit">Search</button>
            </form>
         </div>
         <button
            class="search__btn js-search-btn"
            aria-label="Search">
            <svg role="presentation" focusable="false" height="18" width="18">
               <use xlink:href="https://myrealbook.vintherine.org/assets/svg/svg-map.svg#search"/>
            </svg>
         </button>
      </div>

</header>
<main>
   <div class="wrapper">
         <article class="post">
            <header class="post__header">
               <h1 class="post__title">
                  Marques de repères et de reprises (Rehearsal Marks)
               </h1>
                  <div class="post__meta">
                        <div class="post__author">By
                              <a href="https://myrealbook.vintherine.org/authors/vincent/" class="invert" rel="author" title="Vincent">Vincent</a>
                        </div>

                  </div>
            </header>

            <div class="post__inner">
               <div class="post__entry">
                  <p>C'est ce qu'on appelle un marronnier (sujet qui revient régulièrement) : comment gérer les marques de repères et de reprises (reheasal marks), leurs positions verticales et horizontales, comment les faire apparaître en fin de ligne, comment mettre deux marques successivement... Le besoin le plus fréquemment exprimé est une ligne se terminant par un "D.C. al Coda", la suivante commençant par la Coda en question. </p>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/DCalCoda.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-md.png 768w"  alt="" width="501" height="184"></figure>
<p>Voici un petit tour de mes modestes connaissances  :</p>
<ul>
<li><a href="#mark">la commande \mark et ses (nombreux) \override</a></li>
<li><a href="#double">Double-Mark : deux marques à un saut de ligne</a></li>
<li><a href="#poly">PolyMark, un graveur alternatif</a></li>
</ul>

<h3 id="mark">La commande \mark et ses (nombreux) \override</h3>
<p>Commençons par le commencement : une marque de repère s'obtient par la commande <code>\mark</code> Voici ce qu'en dit la <a href="https://lilypond.org/doc/v2.22/Documentation/notation/writing-text#text-marks">documentation</a> :</p>
<p class="msg msg--highlight ">Le résultat de <code>\mark</code> n’apparaîtra que sur la portée supérieure d’un système. Si vous introduisez la commande <code>\mark</code> au moment d’une barre de mesure, la marque se placera au-dessus de la barre. Si vous y faites appel au milieu d’une mesure, cette marque sera positionnée entre les notes. Si elle intervient en début de ligne, elle sera placée juste avant la première note de cette portée. Enfin, une marque qui tomberait sur un saut de ligne sera imprimée au début de la ligne suivante. </p>
<p>Ce qui n'est pas précisément explicité c'est que sauf dispositif complémentaire  il n'est pas possible de placer plus d'une marque au même endroit.</p>
<p>Il est possible par des <code>\override</code> de modifier les comportements par défaut</p>
<ul>
<li>Direction (haut / bas)
<ul>
<li>Haut (défaut)  : <code>[\once] \override Score.RehearsalMark #'direction = #UP</code></li>
<li>Bas  :  <code>[\once] \override Score.RehearsalMark #'direction = #DOWN</code></li>
</ul>
</li>
<li>Alignement (gauche / centre / droit)
<ul>
<li>Gaughe : <code>[\once] \override Score.RehearsalMark #'self-alignment-X = #LEFT</code></li>
<li>Centre (défaut) : <code>[\once] \override Score.RehearsalMark #'self-alignment-X = #CENTER</code></li>
<li>Droit :  <code>[\once] \override Score.RehearsalMark #'self-alignment-X = #RIGHT</code></li>
</ul>
</li>
<li>Fin de ligne
<ul>
<li><code>\once \override Score.RehearsalMark.break-visibility = #end-of-line-visible</code></li>
</ul>
</li>
</ul>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/Directions.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/Directions-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/Directions-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/Directions-md.png 768w"  alt="" width="546" height="260"></figure>
<p>Si l’alignement se fait par défaut sur la barre de mesure il est possible de choisir  un autre objet tel que clef, armure, métrique, respiration...</p>
<p>Par exemple : </p>
<ul>
<li><code>[\once] override Score.RehearsalMark.break-align-symbols = #'(clef)</code></li>
<li><code>[\once] \override Score.RehearsalMark.break-align-symbols = #'(time-signature)</code></li>
</ul>
<p>extrait de la  <a href="http://lilypond.org/doc/v2.22/Documentation/notation/aligning-objects#using-the-break_002dalignable_002dinterface">documentation </a> : </p>
<p class="msg msg--highlight ">Les différents objets sur lesquels l’alignement pourrait intervenir seront regroupés dans une liste. Si l’un des objets est invisible à l’endroit voulu, en raison d’un réglage de <code>break-visibility</code> ou bien par forçage de la visibilité des armures et clefs, le repère ou le numéro de mesure viendra s’aligner sur le premier élément de cette liste qui soit visible. Dans le cas où aucun objet de la liste n’est visible, l’alignement se fera sur la barre de mesure ou, dans le cas où la barre de mesure est invisible, à l’endroit même où la barre prendrait place. </p>
<p>Enfin la propriété <code>extra-offset</code> offre la possibilité de contrôler entièrement le placement d’un objet, aussi bien horizontalement que verticalement. :</p>
<ul>
<li>[<code>\once] \override Score.RehearsalMark.extra-offset = #'(X . Y)</code></li>
</ul>
<p>X et Y sont des nombres décimaux permettant de déplacer vers la droite / vers le haut s'ils sont positifs, vers la gauche / vers le bas s'ils sont négatif.</p>
<h3 id="double">Double-Mark : deux marques à un saut de ligne</h3>
<p>Double-Mark est une fonction écrite par ArnoldTheresius pour gérer spécifiquement deux marques successives lors d'un saut de lignes (l'une avant l'autre après).  Elle est disponible sur <a href="https://lsr.di.unimi.it/LSR/Item?id=977">cette page de lsr</a> (un clic sur l'image affiche le code). Enregistrez-la dans un fichier à inclure. Sa syntaxe :</p>
<pre><code>\doubleMark</code><br><code>   texte ou \markup</code><br><code>   texte ou \markup</code></pre>
<p>La marque avant le saut de ligne sera alignée à droite, celle après le saut de ligne à gauche et toutes deux seront positionnées par défaut au dessus du système de portées. Il est possible de modifier la direction haut / bas  par un appel préalable à une fonction complémentaire <code>\set_mark-y-dir</code> que l'on trouve sur la même page.</p>
<p class="msg msg--success"><strong>Préalable</strong> : \set_mark-y-dir fonctionne parfaitement (lilypond 2.22.2) si ce n'est que Frescobaldi lisant quelque-chose commençant par \set  s'attend à un signe égal avant l'argument et perd tous ses moyens tant en matière d’indentation que d’autocomplétion. Une manière simple de contourner le problème est de rebaptiser mark-y-dir la fonction <strong>dans le fichier inclus</strong> en supprimant le set du début. <strong>C'est sous cette forme que j'y ferai référence</strong>. </p>
<p>La commande prend en paramètre optionnel une "alist" de paire d'arguments dont le premier est la position par rapport au point d'insertion (avant = left, après = right) et le second la position verticale (au dessus = UP, au dessous = DOWN). Pour indiquer par exemple un "D.C. al coda" en dessous de la portée puis, après le saut de ligne, un signe coda au dessus de la portée (image en haut de page) :</p>
<pre><code>include "double-mark.ly"<br><br>\relative c'' {
    c2 c c c \break
    \mark-y-dir #`(  (,left . ,DOWN) (,right . ,UP) 
    \doubleMark
    \markup  {\with-color #red "D.S. al Coda" }
    \markup { \with-color #red  \musicglyph "scripts.varcoda" }
    c c c c \bar ".." 
}</code></pre>
<p>Ceci est assez peu intuitif puisque après un saut de ligne les valeurs gauche et droite nous paraissent inversées mais on fini par s'y faire.</p>
<p class="msg msg--success"><strong>Attention</strong> :<code>\mark-y-dir</code> fait un <code>\override</code> de <code>Score.RehearsalMark.before-line-breaking</code> qui influencera sur les <code>\mark</code> suivants. Dans ce cas penser à faire un <code>\revert Score.RehearsalMark.before-line-breaking</code>.</p>
<h3 id="poly">PolyMark, un graveur alternatif</h3>
<p>C'est à ce même ArnoldTheresius que nous devons PolyMark qui se présente comme un graveur alternatif à \mark. On le trouve sur <a href="https://lsr.di.unimi.it/LSR/Item?id=976">cette page lsr</a>. Il semble au premier abord un peu plus complexe à prendre en main mais dès qu'on a compris son fonctionnement  il ressemble fort à la solution universelle. </p>
<p>la commande : <code>\polyMark #'identifiant [texte ou \markup]</code></p>
<p>Pour résumer on peut mettre autant de marques à un même point d'insertion pour autant qu'elle aient des mêmes identifiants différents. Pour afficher un repère  <code>\polyMark \default</code> fonctionne mais pas <span style="text-decoration: line-through;"><code>\polyMark #1</code> .</span></p>
<p>En l'absence d'indications de direction et d'alignement les valeurs par défaut sont <em>centré</em> et <em>au dessus</em>. En cas de multiples marques celles-ci seront alors empilées.</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>    c2 c \polyMark \default</code><br><code>    c2 c</code><br><code>    \polyMark #'myKey "something"</code><br><code>    \polyMark #'anotherKey \markup "something else"</code><br><code>    c c</code><br><code>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/DoublePolyMark.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/DoublePolyMark-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DoublePolyMark-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DoublePolyMark-md.png 768w"  alt="" width="522" height="120"></figure>
<p>Il est possible d'indiquer de différentes manières directions et alignements.</p>
<p>La manière basique (mais pas la plus simple) :</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>  c c \polyMark #'W "Default" c c \break</code><br><code>  \polyMark #'(X (direction . -1) (self-alignment-X . -1.0) )  "New Line"</code><br><code>  \polyMark #'(Y (direction . -1) (self-alignment-X . 1.0) (break-visibility . #(#t #f #f)))  "Down"</code><br><code>  \polyMark #'(Z (self-alignment-X . 1.0) (break-visibility . #(#t #f #f)))  "Up"</code><br><code>  c c c c</code><br><code>  \bar ".." <br>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir1.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir1-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir1-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir1-md.png 768w"  alt="" width="505" height="189"></figure>
<p>En utilisant les mêmes<code> \tweak</code> ou <code>\override</code> qu'avec<code> \mark</code> :</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>  c2 c  </code><br><code>  \polyMark #'myKey "UP"</code><br><code>  \tweak direction #DOWN</code><br><code>  \polyMark #'anotherKey \markup "DOWN"</code><br><code>  c c 2 c</code><br><code>  \once \override Score.RehearsalMark #'self-alignment-X = #RIGHT</code><br><code>  \once \override Score.RehearsalMark.break-visibility = #end-of-line-visible</code><br><code>  \polyMark #'EOF "End of Line"</code><br><code>  \bar ".." </code><br><code>}</code></pre>
<p class="msg msg--success">N.B. voir sur cette page la différence entre <code>\tweak</code> et <code>\override</code></p>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir3.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir3-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir3-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir3-md.png 768w"  alt="" width="507" height="104"></figure>
<p>En définissant dans un layout des valeurs associées à un identifiant</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\score {</code><br><code>  \relative c'' {</code><br><code>    c2 c  c2 c</code><br><code>    \polyMark #'DC "D.C. al Coda"</code><br><code>    \bar ".." </code><br><code>  }</code><br><code>  \layout {</code><br><code>    \context { \Score</code><br><code>               polyMarkOptions = #`((DC</code><br><code>                                     (direction        . ,DOWN)</code><br><code>                                     (self-alignment-X . ,RIGHT)</code><br><code>                                     (break-visibility . ,begin-of-line-invisible)))</code><br><code>  } }</code><br><code>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir2.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir2-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir2-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir2-md.png 768w"  alt="" width="499" height="105"></figure>
<p>Enfin j'ai gardé le meilleur pour la fin : il y a au sein du fichier poly-mark-engraver.ly une "<em>default-option-lists</em>" sur le modèle de polyMarkOptions et que l'on vient de voir et que l'on peut utiliser à tous moments sans avoir à les déclarer. Les identifiants parlent d'eux-mêmes et sont facile à retenir : RightUp, RightDown, Right, CenterEndUp, CenterEndDown, CenterEnd, LeftUp, LeftDown, Left, CenterUp, CenterDown, Center, CenterEndBoth, CenterEndBothRotated, CenterEndBothMirrore. Complétez-la avec des options que vous utilisez fréquemment : pour ma part j'ai ajouté RighEnd et RightEndDown. voici quelques exemples : </p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>  c1  </code><br><code>  \polyMark #'Right \markup \with-color #red \musicglyph "scripts.varsegno"</code><br><code>  \tweak extra-offset #'(1 . -4.5)</code><br><code>  \polyMark #'Left \default</code><br><code>  c</code><br><code>  \polyMark #'Right "RightUp"</code><br><code>  \polyMark #'LeftDown "LeftDown"</code><br><code>  c</code><br><code>  \polyMark #'CenterEndBothRotated \markup \musicglyph "scripts.ufermata"  </code><br><code>  \bar ".." </code><br><code>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir4.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir4-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir4-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir4-md.png 768w"  alt="" width="505" height="109"></figure>
               </div>
                  <footer>


                        <div class="post__tags-share">

                        </div>


                  </footer>
            </div>
         </article>



   </div>

</main>
<footer class="footer">
      <div class="footer__copyright">
         <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br />Tous les textes, images et codes sources Lilypond contenus dans ce site sont mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licence Creative Commons Attribution -  Partage dans les Mêmes Conditions 4.0 International</a>.
      </div>
</footer>
<script>
   window.publiiThemeMenuConfig = {    
      mobileMenuMode: 'sidebar',
      animationSpeed: 300,
      submenuWidth: 'auto',
      doubleClickTime: 500,
      mobileMenuExpandableSubmenus: true, 
      relatedContainerForOverlayMenuSelector: '.navbar',
   };
</script>
<script defer src="https://myrealbook.vintherine.org/assets/js/scripts.min.js?v=8b3e67b51e8c7a7d51b33f4a94ae4287"></script>
   <script>        
      var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }
   </script>



</body>
</html>
